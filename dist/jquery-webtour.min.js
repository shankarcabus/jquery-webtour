/*! jQuery Webtour - v0.1.0 - 2013-07-27
* https://github.com/Helielson/jquery-webtour
* Copyright (c) 2013 Helielson; Licensed MIT */
(function(t,e,i,n){function o(e,i){this.element=t(e),this.options=t.extend({},d,i),this._defaults=d,this._name=s,this.init()}var s="tour",d={text:"Lorem Ipsum",arrowImage:"",arrowOrigin:"T",arrowTarget:"B",arrowPadding:0,textOrigin:"T",textTarget:"BL",textWidth:200,textPadding:0,padding:0,button:{clss:"btn btn-primary",text:"Ok, got it"},callback:function(){},lock:!0};o.prototype={init:function(){if(0>=this.element.length)return!1;var e=this,i=t("body"),o=i.data("stepIndex")===n?0:i.data("stepIndex"),s=t("<div/>").addClass("tour step"+o),d=t("<div/>").html("<p>"+this.options.text+"</p>").width(this.options.textWidth).addClass("tour-text").css("padding",this.options.textPadding),a=t("<button/>").addClass(e.options.button.clss).html(e.options.button.text).on("click",function(){var n=t(".tour.step"+(o+1));n.length>0?n.hide().css("visibility","visible").fadeIn():i.css({overflow:"initial"}),t(".tour.step"+o).fadeOut(),e.options.callback()});d.append(a);var r=t("<img/>").load(function(){var t=e.getCoordinate(e.element,e.options.arrowTarget),i=e.getPosition(r,e.options.arrowOrigin,t);r.css(i);var n=e.getCoordinate(r,e.options.textTarget),o=e.getPosition(d,e.options.textOrigin,n);d.css(o)}).attr({src:this.options.arrowImage}).addClass("tour-arrow").css("padding",this.options.arrowPadding);this.options.lock&&s.append(t("<div/>").css({"z-index":100001,position:"absolute",width:"100%",height:"100%",top:0,left:0})),s.append(r).append(d),this.makeMask(s),0===o?s.css("visibility","visible"):s.css("visibility","hidden"),i.append(s).css({overflow:"hidden"}).data("stepIndex",o+1)},makeMask:function(i){function n(){p.css({top:0,left:c.element.offset().left-u,width:c.element.outerWidth()+2*u,height:c.element.offset().top-u})}function o(){f.css({top:0,right:0,width:g.outerWidth()-c.element.offset().left-c.element.outerWidth()-u,height:"100%"})}function s(){h.css({bottom:0,left:c.element.offset().left-u,width:c.element.outerWidth()+2*u,height:g.outerHeight()-c.element.offset().top-c.element.outerHeight()-u})}function d(){l.css({top:0,left:0,width:c.element.offset().left-u,height:"100%"})}function a(){n(),d(),o(),s()}var r=t("<div/>").addClass("mask"),p=r.clone(),f=r.clone(),h=r.clone(),l=r.clone(),u=this.options.padding,c=this,g=t("body");t(e).resize(function(){a()}),a(),i.append(p).append(f).append(h).append(l)},getCoordinate:function(t,e){var i={x:0,y:0},n=t.offset().top,o=n+t.outerHeight()/2,s=n+t.outerHeight(),d=t.offset().left,a=d+t.outerWidth()/2,r=d+t.outerWidth();return i.y=e.indexOf("T")>=0?n:e.indexOf("B")>=0?s:o,i.x=e.indexOf("L")>=0?d:e.indexOf("R")>=0?r:a,i},getPosition:function(t,e,i){var n={left:0,top:0},o=t.outerWidth(),s=t.outerHeight();return n.top=e.indexOf("T")>=0?i.y:e.indexOf("B")>=0?i.y-s:i.y-s/2,n.left=e.indexOf("L")>=0?i.x:e.indexOf("R")>=0?i.x-o:i.x-o/2,n}},t.fn[s]=function(e){return this.each(function(){t.data(this,"plugin_"+s)||t.data(this,"plugin_"+s,new o(this,e))})}})(jQuery,window,document);